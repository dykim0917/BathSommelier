Issue Type,Summary,Description,Epic Name,Epic Link,Labels,Priority,Components,Fix Version
Epic,"[E0] Contract & Compliance Foundation","Goal: Team-wide contract alignment and release-blocking compliance baseline.","E0 Contract & Compliance Foundation",,"bathsommelier v3_10_2 market_first compliance",Highest,"core-engine,compliance",v3.10.2-MVP
Story,"[E0-S1] PRD contract types and runtime validation","Goal:\n- Lock PRD contracts to code types.\nAcceptance Criteria:\n- [ ] 1:1 field mapping for HomeOrchestrationContract, EngineSelector, ProductProfile, ModeProtocol\n- [ ] Runtime validation logs errors without silent fallback\nDependencies:\n- None\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Sections 24,26)\n- /Users/exem/DK/BathSommelier/docs/POLICY_APPENDIX.md",,"E0 Contract & Compliance Foundation","bathsommelier v3_10_2 market_first contract",Highest,core-engine,v3.10.2-MVP
Story,"[E0-S2] Persistent legal disclaimer","Goal:\n- Keep legal disclaimer always visible in required surfaces.\nAcceptance Criteria:\n- [ ] Same fixed text shown in settings and recipe\n- [ ] No shortened/modified copy\n- [ ] Screenshot QA checklist passes\nDependencies:\n- None\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 21)",,"E0 Contract & Compliance Foundation","bathsommelier v3_10_2 market_first legal",Highest,compliance,v3.10.2-MVP
Story,"[E0-S3] Copy safety gate","Goal:\n- Prevent medical-claim copy from entering product surfaces.\nAcceptance Criteria:\n- [ ] Forbidden claim detection checklist defined\n- [ ] Applied to recommendation/product/trip narrative text\n- [ ] Release checklist includes 0 policy violations\nDependencies:\n- E0-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 13)",,"E0 Contract & Compliance Foundation","bathsommelier v3_10_2 market_first copy",Highest,compliance,v3.10.2-MVP
Epic,"[E1] Onboarding & Intake","Goal: Collect minimum signal for state, safety, and environment with low friction.","E1 Onboarding & Intake",,"bathsommelier v3_10_2 market_first onboarding",High,app-ui,v3.10.2-MVP
Story,"[E1-S1] Lightweight onboarding (2-3 questions)","Goal:\n- Complete onboarding under 30 seconds.\nAcceptance Criteria:\n- [ ] onboarding_variant_exposed and onboarding_completed events recorded\n- [ ] questions_count included\nDependencies:\n- E0-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 9)\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E1 Onboarding & Intake","bathsommelier v3_10_2 market_first onboarding analytics",High,"app-ui,analytics",v3.10.2-MVP
Story,"[E1-S2] Today Signal + optional safety input","Goal:\n- Persist active_state and optional safety context.\nAcceptance Criteria:\n- [ ] Exactly one active_state is always stored\n- [ ] Health input is optional with safety reason text\n- [ ] health_input_prompt_seen and health_input_submitted_optional events recorded\nDependencies:\n- E1-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Sections 6,9)",,"E1 Onboarding & Intake","bathsommelier v3_10_2 market_first onboarding safety",High,"app-ui,core-engine",v3.10.2-MVP
Story,"[E1-S3] Environment normalization","Goal:\n- Normalize partial bath subtype data shape.\nAcceptance Criteria:\n- [ ] partial_bath_subtype persists as low_leg or footbath\n- [ ] Legacy direct footbath value blocked\n- [ ] environment and partial_bath_subtype included in recommendation events\nDependencies:\n- E1-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 6)\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E1 Onboarding & Intake","bathsommelier v3_10_2 market_first onboarding analytics",High,"core-engine,analytics",v3.10.2-MVP
Epic,"[E2] EngineSelector Policy Implementation","Goal: Deterministic mode selection from policy appendix.","E2 EngineSelector Policy Implementation",,"bathsommelier v3_10_2 market_first engine",Highest,core-engine,v3.10.2-MVP
Story,"[E2-S1] Base state-to-mode mapping","Goal:\n- Implement appendix v1.1 base mapping exactly.\nAcceptance Criteria:\n- [ ] cant_sleep->sleep, want_reset->reset, heavy->recovery, tension->recovery, low_mood->recovery\n- [ ] Unit tests pass for all 5 mappings\nDependencies:\n- E1-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/POLICY_APPENDIX.md (3.1)",,"E2 EngineSelector Policy Implementation","bathsommelier v3_10_2 market_first engine policy",Highest,core-engine,v3.10.2-MVP
Story,"[E2-S2] Time-context overrides","Goal:\n- Apply deterministic overrides by time_context.\nAcceptance Criteria:\n- [ ] late_night & !want_reset -> sleep\n- [ ] morning & cant_sleep -> recovery\n- [ ] day/evening & tension -> recovery\nDependencies:\n- E2-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/POLICY_APPENDIX.md (3.2)",,"E2 EngineSelector Policy Implementation","bathsommelier v3_10_2 market_first engine policy",Highest,core-engine,v3.10.2-MVP
Story,"[E2-S3] Priority resolution + fallback strategies","Goal:\n- Enforce precedence and 4 fallback strategies.\nAcceptance Criteria:\n- [ ] Safety > Active state > Time override > Preference > Trip overlay\n- [ ] DEFAULT_STARTER_RITUAL, SAFE_ROUTINE_ONLY, RESET_WITHOUT_COLD, ROUTINE_ONLY_NO_COMMERCE implemented\n- [ ] fallback_strategy_applied tracked\nDependencies:\n- E2-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/POLICY_APPENDIX.md (4,5)",,"E2 EngineSelector Policy Implementation","bathsommelier v3_10_2 market_first engine safety",Highest,"core-engine,analytics",v3.10.2-MVP
Epic,"[E3] CareEngine + Safety Gate","Goal: Generate mode protocols with safety override as absolute precedence.","E3 CareEngine + Safety Gate",,"bathsommelier v3_10_2 market_first safety",Highest,"core-engine,safety",v3.10.2-MVP
Story,"[E3-S1] ModeProtocol computation","Goal:\n- Return protocol params for sleep/reset/recovery.\nAcceptance Criteria:\n- [ ] temp/duration/lighting/scent/audio computed per mode\n- [ ] reset default variant is non_cold_activation\n- [ ] mode_protocol_applied event recorded\nDependencies:\n- E2-S3\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Sections 23,20)",,"E3 CareEngine + Safety Gate","bathsommelier v3_10_2 market_first engine safety",Highest,"core-engine,analytics",v3.10.2-MVP
Story,"[E3-S2] Safety override enforcement","Goal:\n- Override risky protocols before execution surfaces.\nAcceptance Criteria:\n- [ ] high-risk users get temp cap + environment downgrade\n- [ ] reset contraindications hide all cold-stage CTA\n- [ ] mode_protocol_overridden_by_safety event recorded\nDependencies:\n- E3-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Sections 12,20,23)",,"E3 CareEngine + Safety Gate","bathsommelier v3_10_2 market_first safety",Highest,"core-engine,safety",v3.10.2-MVP
Story,"[E3-S3] Default starter and safe-only routines","Goal:\n- Apply config-driven fallback routines.\nAcceptance Criteria:\n- [ ] data_sparse -> default_starter_ritual\n- [ ] high_risk -> safe_routine_only\n- [ ] runtime values match CONFIG appendix\nDependencies:\n- E3-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/CONFIG_APPENDIX.md",,"E3 CareEngine + Safety Gate","bathsommelier v3_10_2 market_first safety config",Highest,"core-engine,safety",v3.10.2-MVP
Epic,"[E4] Home Orchestration Surface","Goal: Present one decision-ready path without forcing Care/Trip selection.","E4 Home Orchestration Surface",,"bathsommelier v3_10_2 market_first home",High,app-ui,v3.10.2-MVP
Story,"[E4-S1] Home contract rendering","Goal:\n- Render all HomeOrchestrationContract fields.\nAcceptance Criteria:\n- [ ] today_signal, primary, secondary<=2, quick_actions, insight_strip, fallback_strategy shown\n- [ ] no direct Care/Trip selection UI\n- [ ] exactly one primary suggestion\nDependencies:\n- E2-S3\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 26)",,"E4 Home Orchestration Surface","bathsommelier v3_10_2 market_first home ui",High,app-ui,v3.10.2-MVP
Story,"[E4-S2] Primary/secondary placement policy","Goal:\n- Apply output placement policy from EngineSelector rules.\nAcceptance Criteria:\n- [ ] default CARE_PRIMARY__TRIP_SECONDARY\n- [ ] low_mood|want_reset gives Trip secondary priority\n- [ ] shower uses Trip Lite preference, bathtub/partial allows Trip Deep\nDependencies:\n- E4-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/POLICY_APPENDIX.md (3.3)",,"E4 Home Orchestration Surface","bathsommelier v3_10_2 market_first home trip",High,"app-ui,core-engine",v3.10.2-MVP
Story,"[E4-S3] Recommendation card funnel events","Goal:\n- Make recommendation CTR measurable.\nAcceptance Criteria:\n- [ ] recommendation_card_impression and recommendation_card_click events recorded\n- [ ] suggestion_id, suggestion_rank, engine_source included\n- [ ] numerator/denominator analytics can be computed\nDependencies:\n- E4-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E4 Home Orchestration Surface","bathsommelier v3_10_2 market_first analytics home",High,"app-ui,analytics",v3.10.2-MVP
Epic,"[E5] Explanation Contract & Detail","Goal: Improve trust and conversion with why/goal/alternative explanation.","E5 Explanation Contract & Detail",,"bathsommelier v3_10_2 market_first explanation",High,"app-ui,core-engine",v3.10.2-MVP
Story,"[E5-S1] Explanation contract rendering","Goal:\n- Render full explanation contract in recommendation detail.\nAcceptance Criteria:\n- [ ] state_label, why_summary, routine_params, expected_goal, alternative_routine rendered\n- [ ] copy policy compliant\n- [ ] missing fields show safe fallback text, not crash\nDependencies:\n- E4-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 7)",,"E5 Explanation Contract & Detail","bathsommelier v3_10_2 market_first explanation",High,app-ui,v3.10.2-MVP
Story,"[E5-S2] Why-to-start conversion funnel","Goal:\n- Track conversion impact of explanation layer.\nAcceptance Criteria:\n- [ ] why_explainer_exposed and routine_started_after_why recorded\n- [ ] one-tap CTA from detail to routine start\n- [ ] start failure shows retryable error message\nDependencies:\n- E5-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E5 Explanation Contract & Detail","bathsommelier v3_10_2 market_first explanation analytics",High,"app-ui,analytics",v3.10.2-MVP
Epic,"[E6] Routine Execution (Prep->Run->Finish)","Goal: Complete execution funnel from start to completion snapshot.","E6 Routine Execution (Prep->Run->Finish)",,"bathsommelier v3_10_2 market_first routine",High,app-ui,v3.10.2-MVP
Story,"[E6-S1] Three-step routine execution","Goal:\n- Keep routine execution deterministic across environments.\nAcceptance Criteria:\n- [ ] prep -> immerse/shower -> finish transitions work\n- [ ] stop button always visible\n- [ ] safe_routine_only keeps same UX rules\nDependencies:\n- E5-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Section 8)",,"E6 Routine Execution (Prep->Run->Finish)","bathsommelier v3_10_2 market_first routine safety",High,"app-ui,safety",v3.10.2-MVP
Story,"[E6-S2] Completion snapshot persistence","Goal:\n- Persist routine completion data for history and learning.\nAcceptance Criteria:\n- [ ] routine_start and routine_complete events recorded\n- [ ] completion snapshot saved\n- [ ] history view can read completion data\nDependencies:\n- E6-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (Sections 10,25.9)",,"E6 Routine Execution (Prep->Run->Finish)","bathsommelier v3_10_2 market_first routine analytics",High,"app-ui,analytics",v3.10.2-MVP
Epic,"[E7] Product Matching (Care Commerce)","Goal: Enforce environment-safe matching and deterministic slot composition.","E7 Product Matching (Care Commerce)",,"bathsommelier v3_10_2 market_first commerce",Medium,"commerce,core-engine",v3.10.2-MVP
Story,"[E7-S1] Environment compatibility filter","Goal:\n- Apply environment filter as stage-1 gate.\nAcceptance Criteria:\n- [ ] filter_by_environment runs before safety/score\n- [ ] shower excludes bath-only categories\n- [ ] partial_bath treated as bathtub-compatible\nDependencies:\n- E3-S3\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (24.2-1)",,"E7 Product Matching (Care Commerce)","bathsommelier v3_10_2 market_first commerce safety",Medium,"commerce,core-engine",v3.10.2-MVP
Story,"[E7-S2] Scoring and slot composition","Goal:\n- Keep mode scoring and slots reproducible.\nAcceptance Criteria:\n- [ ] weights fixed to 0.4/0.3/0.2/0.1\n- [ ] Sleep A=bicarbonate, Recovery A=magnesium, Recovery C=bicarbonate/value\n- [ ] low/mid/high price diversity maintained\nDependencies:\n- E7-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (24.3,24.4)",,"E7 Product Matching (Care Commerce)","bathsommelier v3_10_2 market_first commerce",Medium,"commerce,core-engine",v3.10.2-MVP
Story,"[E7-S3] Commerce event instrumentation","Goal:\n- Enable commerce KPI computation without data loss.\nAcceptance Criteria:\n- [ ] product_detail_view, affiliate_link_click, sommelier_pick_click recorded\n- [ ] product_id, slot, price_tier, sommelier_pick are mandatory\n- [ ] events missing required fields excluded from KPI aggregation\nDependencies:\n- E7-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E7 Product Matching (Care Commerce)","bathsommelier v3_10_2 market_first commerce analytics",Medium,"commerce,analytics",v3.10.2-MVP
Epic,"[E8] TripEngine MVP (Secondary-first)","Goal: Add immersion support without increasing Home decision load.","E8 TripEngine MVP (Secondary-first)",,"bathsommelier v3_10_2 market_first trip",Medium,"trip,app-ui",v3.10.2-MVP
Story,"[E8-S1] Trip Lite/Deep branching","Goal:\n- Support environment-aware trip variants with override support.\nAcceptance Criteria:\n- [ ] shower defaults to Lite, bathtub/partial allows Deep\n- [ ] override behavior available\n- [ ] trip_theme_selected and trip_immersion_started recorded\nDependencies:\n- E4-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (25.4,25.5)",,"E8 TripEngine MVP (Secondary-first)","bathsommelier v3_10_2 market_first trip",Medium,"trip,app-ui",v3.10.2-MVP
Story,"[E8-S2] Narrative immersion surface","Goal:\n- Deliver narrative-led trip detail surface with policy-safe copy.\nAcceptance Criteria:\n- [ ] narrative text rendered in trip detail\n- [ ] no medical/physiological claim terms\n- [ ] trip_narrative_engaged event recorded\nDependencies:\n- E8-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (25.6)\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (13.4)",,"E8 TripEngine MVP (Secondary-first)","bathsommelier v3_10_2 market_first trip copy",Medium,"trip,analytics",v3.10.2-MVP
Story,"[E8-S3] Trip commerce boundary enforcement","Goal:\n- Keep Trip commerce separate from care mechanism scoring.\nAcceptance Criteria:\n- [ ] TripCommerceBundle does not use Section 24 scoring\n- [ ] trip uses theme CTA variants\n- [ ] ProductHub remains supporting layer only\nDependencies:\n- E8-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (25.8,27)",,"E8 TripEngine MVP (Secondary-first)","bathsommelier v3_10_2 market_first trip commerce",Medium,"trip,commerce",v3.10.2-MVP
Epic,"[E9] Analytics & Experimentation","Goal: Build measurable funnel and experiment framework for 6 hypotheses.","E9 Analytics & Experimentation",,"bathsommelier v3_10_2 market_first analytics",High,analytics,v3.10.2-MVP
Story,"[E9-S1] Enforce common event schema","Goal:\n- Guarantee mandatory property coverage for core events.\nAcceptance Criteria:\n- [ ] common_properties mandatory keys enforced\n- [ ] invalid events rejected or quarantined\n- [ ] schema version managed\nDependencies:\n- E0-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/ANALYTICS_APPENDIX.md",,"E9 Analytics & Experimentation","bathsommelier v3_10_2 market_first analytics",High,analytics,v3.10.2-MVP
Story,"[E9-S2] KPI dashboard slices","Goal:\n- Expose PMF and commerce KPI by required segments.\nAcceptance Criteria:\n- [ ] sliced by environment/mode/risk/onboarding_variant/fallback\n- [ ] recommendation->start->complete->revisit funnel available\n- [ ] commerce CTR/conversion/pick share visible\nDependencies:\n- E9-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (19,28)",,"E9 Analytics & Experimentation","bathsommelier v3_10_2 market_first analytics",High,analytics,v3.10.2-MVP
Story,"[E9-S3] Experiment framework","Goal:\n- Operationalize core A/B tests from PRD.\nAcceptance Criteria:\n- [ ] onboarding 1-tap vs 2-3 questions experiment\n- [ ] why exposed vs hidden experiment\n- [ ] 3-slot+pick vs 1-item+deep-description experiment\nDependencies:\n- E9-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (19.3,28)",,"E9 Analytics & Experimentation","bathsommelier v3_10_2 market_first analytics experiment",High,analytics,v3.10.2-MVP
Epic,"[E10] QA Safety Matrix & Release Gate","Goal: Block unsafe releases and enforce quality gates.","E10 QA Safety Matrix & Release Gate",,"bathsommelier v3_10_2 market_first qa safety",Highest,"safety,compliance",v3.10.2-MVP
Story,"[E10-S1] Contraindication safety matrix automation","Goal:\n- Automate safety regression checks for contraindication cases.\nAcceptance Criteria:\n- [ ] cold contraindication users see 0 cold CTA\n- [ ] fall risk users forced into safe routine\n- [ ] orthostatic/hypertension overrides pass\nDependencies:\n- E3-S2\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (12,23)",,"E10 QA Safety Matrix & Release Gate","bathsommelier v3_10_2 market_first qa safety",Highest,"safety,analytics",v3.10.2-MVP
Story,"[E10-S2] Release gate operations","Goal:\n- Operate hard release gates for legal/copy/events.\nAcceptance Criteria:\n- [ ] persistent legal disclaimer check\n- [ ] 0 copy-policy violations\n- [ ] core events collected (onboarding complete/recommendation impression/start/complete/revisit)\nDependencies:\n- E10-S1\nSource References:\n- /Users/exem/DK/BathSommelier/docs/PRD_CURRENT.md (21,29)",,"E10 QA Safety Matrix & Release Gate","bathsommelier v3_10_2 market_first qa compliance",Highest,"compliance,analytics",v3.10.2-MVP
